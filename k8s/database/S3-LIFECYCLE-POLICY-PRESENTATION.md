# S3 수명주기 정책 근거 및 설계 방향

## 📋 정책 개요

AlphaCar 프로젝트는 3개의 S3 버킷에 대해 용도별로 최적화된 수명주기 정책을 수립했습니다.

| 버킷 유형 | 주요 용도 | 최종 보존 기간 | 스토리지 클래스 전환 전략 |
|----------|----------|--------------|----------------------|
| **MongoDB** | 데이터 분석용 백업 | 1년 (365일) | STANDARD → STANDARD_IA → GLACIER → DEEP_ARCHIVE |
| **Yaml** | Kubernetes 설정 파일 | 2년 (730일) | STANDARD → STANDARD_IA → GLACIER |
| **Carimage** | 차량 이미지 파일 | 3년 (1095일) | STANDARD → STANDARD_IA → GLACIER |

---

## 1️⃣ MongoDB 백업 버킷 수명주기 정책

### 정책 상세

| 기간 | 스토리지 클래스 | 전환 시점 | 복원 시간 |
|------|----------------|----------|----------|
| 0-30일 | STANDARD | 생성 즉시 | 즉시 (~수 초) |
| 31-90일 | STANDARD_IA | 30일 후 | 즉시 (~수 초) |
| 91-180일 | GLACIER | 90일 후 | 3-5시간 |
| 181-365일 | DEEP_ARCHIVE | 180일 후 | 12시간 |
| 366일+ | **삭제** | 365일 후 | - |

### 정책 근거

#### 1. 보존 기간: 1년 (365일)

**근거:**
- ✅ **데이터 분석 주기**: 월별, 분기별, 연도별 비교 분석을 위해 최소 1년간의 데이터 필요
- ✅ **비즈니스 인사이트**: 연간 트렌드 분석, 계절성 패턴 분석에 활용
- ✅ **법적 요구사항**: 일부 규정에서 1년간 데이터 보존 요구
- ✅ **비용 효율성**: 1년 이상 보존 시 분석 가치 대비 스토리지 비용이 증가

**대안 검토:**
- ❓ "2년 보존을 고려했으나..."
  - **결정**: 1년 보존으로 결정
  - **이유**: 
    - 차량 정보는 시간이 지날수록 가치가 급격히 하락
    - 1년간의 데이터로 충분한 트렌드 분석 가능 (월별, 분기별, 연도별 비교)
    - 비용 효율성: 1년 이상 보존 시 분석 가치 대비 스토리지 비용 증가

#### 2. 스토리지 클래스 전환 시점

**30일 → STANDARD_IA 전환:**
- **근거**: 일일 백업 30개 = 1개월 분량
- 최근 1개월은 빠른 복원 가능성 높음 → STANDARD_IA로 비용 절감
- STANDARD_IA는 STANDARD 대비 약 **50% 비용 절감** (접근 빈도 낮음)

**90일 → GLACIER 전환:**
- **근거**: 일일 백업 90개 = 3개월 분량
- 분기별 백업으로 활용, 복원 빈도 매우 낮음
- GLACIER는 STANDARD 대비 약 **80% 비용 절감**
- 복원 시 3-5시간 소요 가능 (분석 목적상 충분)

**180일 → DEEP_ARCHIVE 전환:**
- **근거**: 반기별, 연도별 백업으로 활용
- 복원 빈도 극히 낮음 (분석 목적 또는 규정 준수용)
- DEEP_ARCHIVE는 STANDARD 대비 약 **95% 비용 절감**
- 복원 시 12시간 소요 가능 (비상 상황에만 사용)

---

## 2️⃣ Yaml 버킷 수명주기 정책

### 정책 상세

| 기간 | 스토리지 클래스 | 전환 시점 | 복원 시간 |
|------|----------------|----------|----------|
| 0-30일 | STANDARD | 생성 즉시 | 즉시 (~수 초) |
| 31-180일 | STANDARD_IA | 30일 후 | 즉시 (~수 초) |
| 181-730일 | GLACIER | 180일 후 | 3-5시간 |
| 731일+ | **삭제** | 730일 후 | - |

### 정책 근거

#### 1. 보존 기간: 2년 (730일)

**근거:**
- ✅ **Kubernetes 인프라 변경 추적**: 인프라 설정 변경 이력 추적 및 감사 목적
- ✅ **재해 복구 시나리오**: 2년간의 인프라 설정 보관으로 장기 복구 가능
- ✅ **설정 롤백**: 최근 2년간의 설정 변경 사항 비교 분석
- ✅ **업계 표준**: Kubernetes 인프라 백업의 일반적인 보존 기간 (1-3년)

**설정 파일 특성:**
- 변경 빈도: 낮음 (주로 배포 시 변경)
- 복원 필요성: 재해 복구 시에만 필요
- 파일 크기: 작음 (YAML 파일은 텍스트 기반)

#### 2. 스토리지 클래스 전환 시점

**30일 → STANDARD_IA 전환:**
- 최근 1개월간 설정 파일은 빠른 복원 가능성이 있음
- STANDARD_IA로 비용 절감하면서도 즉시 복원 가능

**180일 → GLACIER 전환:**
- 6개월 이상 된 설정 파일은 복원 빈도 극히 낮음
- GLACIER로 전환하여 비용 최소화
- 재해 복구 시나리오에서만 복원 (3-5시간 소요 가능)

---

## 3️⃣ Carimage 버킷 수명주기 정책

### 정책 상세

| 기간 | 스토리지 클래스 | 전환 시점 | 복원 시간 |
|------|----------------|----------|----------|
| 0-90일 | STANDARD | 생성 즉시 | 즉시 (~수 초) |
| 91-365일 | STANDARD_IA | 90일 후 | 즉시 (~수 초) |
| 366-1095일 | GLACIER | 365일 후 | 3-5시간 |
| 1096일+ | **삭제** | 1095일 후 | - |

### 정책 근거

#### 1. 보존 기간: 3년 (1095일)

**근거:**
- ✅ **신차 출시 주기**: 자동차 업계의 신차 출시 주기는 평균 2-3년
- ✅ **모델 라이프사이클**: 차량 모델의 전체 라이프사이클을 커버하기 위해 3년 보존
- ✅ **서비스 연속성**: 3년간의 이미지를 보관하여 과거 모델 정보도 제공 가능
- ✅ **사용자 경험**: 사용자가 과거 모델과 신규 모델을 비교할 수 있도록 지원
- ✅ **법적 요구사항**: 일부 국가에서 제품 이미지 3년 보존 요구

**반대 의견 고려:**
- ❌ "2년 보존을 고려했으나..."
  - **결정**: 3년 보존으로 결정
  - **이유**: 자동차 업계는 모델 변경 주기가 길고, 사용자가 과거 모델 비교를 자주 요청함

#### 2. 스토리지 클래스 전환 시점

**90일 → STANDARD_IA 전환:**
- 최근 3개월간 업로드된 이미지는 사용자 접근 빈도가 높음
- STANDARD_IA로 비용 절감하면서도 즉시 접근 가능
- STANDARD 대비 약 50% 비용 절감

**365일 → GLACIER 전환:**
- 1년 이상 된 이미지는 접근 빈도가 낮아짐
- GLACIER로 전환하여 비용 최소화
- 사용자 요청 시 복원 가능 (3-5시간 소요, 일반적으로 허용 가능)
- STANDARD 대비 약 80% 비용 절감

---

## 💰 비용 절감 효과

### 스토리지 비용 비교 (예상)

| 스토리지 클래스 | GB당 월 비용 (약) | 백업 데이터 100GB 기준 월 비용 |
|----------------|------------------|----------------------------|
| STANDARD | $0.023 | $2.30 |
| STANDARD_IA | $0.0125 | $1.25 (약 46% 절감) |
| GLACIER | $0.004 | $0.40 (약 83% 절감) |
| DEEP_ARCHIVE | $0.00099 | $0.099 (약 96% 절감) |

### 연간 비용 절감 효과 (예상)

**MongoDB 버킷 (일일 백업 100GB 기준):**
- STANDARD만 사용 시: 약 $2,760/년
- 수명주기 정책 적용 시: 약 **$500-800/년** (약 **70-80% 절감**)

**Yaml 버킷 (주간 백업 10GB 기준):**
- STANDARD만 사용 시: 약 $276/년
- 수명주기 정책 적용 시: 약 **$50-80/년** (약 **70-80% 절감**)

**Carimage 버킷 (월간 증가 50GB 기준):**
- STANDARD만 사용 시: 약 $1,380/년
- 수명주기 정책 적용 시: 약 **$300-500/년** (약 **60-80% 절감**)

---

## 📊 정책 수립 원칙

### 1. 데이터 분류 및 중요도 평가

| 데이터 유형 | 중요도 | 접근 빈도 | 복원 필요성 | 보존 우선순위 |
|-----------|--------|----------|-----------|-------------|
| MongoDB 백업 | 높음 | 낮음 (분석 시에만) | 중간 | 높음 |
| Yaml 파일 | 높음 | 낮음 (재해 복구 시에만) | 높음 | 높음 |
| 차량 이미지 | 중간 | 높음 (일반 사용자 요청) | 높음 | 중간 |

### 2. 비즈니스 요구사항 반영

- **데이터 분석 목적**: MongoDB 백업은 분석 가치를 기준으로 보존 기간 결정
- **재해 복구 목적**: Yaml 파일은 복구 시나리오를 기준으로 보존 기간 결정
- **서비스 제공 목적**: 차량 이미지는 사용자 경험을 기준으로 보존 기간 결정

### 3. 비용 효율성 최적화

- **점진적 스토리지 전환**: 접근 빈도에 따라 저렴한 스토리지로 전환
- **자동 삭제**: 보존 가치가 없는 오래된 데이터 자동 삭제
- **비용 대비 가치**: 스토리지 비용 대비 데이터 가치 분석

### 4. 업계 표준 준수

- **데이터 보존 기간**: 업계 표준 및 법적 요구사항 준수
- **스토리지 전환 시점**: AWS 권장 사항 및 업계 베스트 프랙티스 반영

---

## 🔄 정책 검토 및 개선 계획

### 정기 검토 사항

1. **비용 분석**: 월별 스토리지 비용 모니터링 및 최적화
2. **접근 패턴 분석**: 실제 데이터 접근 빈도 분석 및 정책 조정
3. **복원 요청 분석**: 복원 요청 빈도 및 소요 시간 분석
4. **비즈니스 요구사항 변경**: 새로운 요구사항 반영

### 향후 개선 방향

- **접근 패턴 기반 최적화**: CloudWatch 분석을 통한 정책 조정
- **자동화 개선**: 정책 변경 자동화 및 모니터링 강화
- **비용 최적화**: 추가 비용 절감 기회 발굴

---

## 📝 결론

AlphaCar 프로젝트의 S3 수명주기 정책은 다음과 같은 원칙으로 수립되었습니다:

1. ✅ **용도별 최적화**: 각 버킷의 용도에 맞는 보존 기간 및 스토리지 전환 전략
2. ✅ **비용 효율성**: 점진적 스토리지 전환을 통한 비용 최소화 (70-80% 절감)
3. ✅ **비즈니스 요구사항 반영**: 데이터 분석, 재해 복구, 서비스 제공 목적 고려
4. ✅ **업계 표준 준수**: AWS 권장 사항 및 업계 베스트 프랙티스 반영

이 정책을 통해 **데이터 가치를 유지하면서 스토리지 비용을 최소화**하는 목표를 달성할 수 있습니다.

